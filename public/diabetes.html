<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>당뇨병 예방 및 관리 시스템</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="diabetes.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-line"></i> 당뇨병 예방 및 관리 시스템</h1>
            <p>혈당 변동성(GV) 기반 맞춤형 건강 관리</p>
            <nav class="page-nav">
                <a href="index.html" class="active"><i class="fas fa-heartbeat"></i> 고혈압 관리</a>
                <a href="diabetes.html" class="active"><i class="fas fa-chart-line"></i> 당뇨병 관리</a>
            </nav>
        </header>

        <main>
            <!-- 1. 오늘의 혈당 측정 섹션 -->
            <section class="glucose-section">
                <h2><i class="fas fa-tint"></i> 1. 오늘의 혈당 측정</h2>
                <div class="glucose-display-area">
                    <div class="glucose-display">
                        <span class="number" id="glucose-display-value">100</span>
                        <span class="unit">mg/dL</span>
                    </div>
                    <div class="glucose-status normal" id="glucose-status">
                        <i class="fas fa-check-circle"></i>
                        <span class="status-text">정상</span>
                    </div>
                </div>
                <div class="glucose-input-area">
                    <input type="number" id="glucose-input" placeholder="현재 혈당 값" min="30" max="600">
                    <select id="check-time-input">
                        <option value="fasting">공복</option>
                        <option value="pre_meal">식전</option>
                        <option value="post_meal_1hr">식후 1시간</option>
                        <option value="post_meal_2hr">식후 2시간</option>
                        <option value="before_sleep">취침 전</option>
                    </select>
                    <button onclick="updateGlucoseReading()">측정값 저장</button>
                </div>
                <div class="glucose-analysis" id="glucose-analysis-result">
                    <p>혈당 값을 입력하고 '측정값 저장'을 눌러주세요.</p>
                </div>
            </section>

            <!-- 2. AI 식단 분석 (발표용 "Wow" Point) -->
            <section class="meal-analysis-section">
                <h2><i class="fas fa-camera"></i> 2. AI 식단 분석 (혈당 스파이크 예측)</h2>
                <p class="section-description">식단 사진을 업로드하면 AI가 혈당 변화를 예측합니다.</p>
                
                <div class="meal-analysis-content">
                    <div class="meal-upload">
                        <h3><i class="fas fa-image"></i> 식단 사진 업로드</h3>
                        <input type="file" id="meal-image-input" accept="image/*" onchange="previewMealImage(event)">
                        <label for="meal-image-input" class="file-upload-label">
                            <i class="fas fa-upload"></i> 사진 선택하기
                        </label>
                        <img id="meal-preview" class="meal-preview-image" src="https://placehold.co/600x400/e2e8f0/a0aec0?text=Upload+Your+Meal" alt="식단 미리보기">
                        <button onclick="analyzeMeal()" id="analyze-meal-btn">
                            <i class="fas fa-magic"></i> 이 식단 분석하기
                        </button>
                    </div>
                    
                    <div class="meal-result">
                        <h3><i class="fas fa-chart-bar"></i> AI 분석 결과</h3>
                        <div id="meal-analysis-result" class="meal-analysis-placeholder">
                            <p>식단 사진을 올리고 '분석하기'를 눌러주세요.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. 혈당 변동성(GV) 차트 -->
            <section class="gv-chart-section">
                <h2><i class="fas fa-wave-square"></i> 3. 혈당 변동성(GV) 리포트</h2>
                <p class="section-description">혈당이 롤러코스터처럼 널뛰는 것은 아닌지 확인하세요.</p>
                <div class="chart-container">
                    <canvas id="gv-chart-canvas"></canvas>
                </div>
            </section>
        </main>
        
        <!-- 하단 버튼들 (고정) -->
        <footer class="action-buttons">
            <button class="btn-primary" onclick="showInitialChecklist()">
                <i class="fas fa-clipboard-list"></i> 내 건강정보 입력 (최초 1회)
            </button>
            <button class="btn-info" onclick="showDiabetesInfo()">
                <i class="fas fa-info-circle"></i> 당뇨병 정보
            </button>
        </footer>
    </div>

    <!-- 모달 (체크리스트, 정보) -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script src="diabetes.js"></script>
</body>
</html>
